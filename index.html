<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WB: реклама есть — прибыли нет (практический гайд)</title>
  <meta name="description" content="Практический гайд по внутренней рекламе Wildberries: диагностика по воронке, действия по шагам, тесты, экономика с выкупом, шаблоны и калькулятор цены заказа." />

  <style>
    :root{
      --bg:#0B0812;
      --glass: rgba(14,10,22,.58);
      --card: rgba(18,13,30,.78);
      --card2: rgba(12,9,20,.52);
      --line2: rgba(199,185,255,.12);
      --text:#F5F6FA;
      --muted: rgba(199,185,255,.86);
      --muted2: rgba(199,185,255,.70);
      --accent:#7C3AED;
      --accent2:#A78BFA;
      --shadow: 0 18px 46px rgba(0,0,0,.42);
      --r: 18px;
      --r2: 14px;
      --max: 1160px;
      --lh: 1.72;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1100px 760px at 18% -10%, rgba(124,58,237,.26), transparent 60%),
        radial-gradient(900px 650px at 92% 6%, rgba(167,139,250,.16), transparent 55%),
        linear-gradient(180deg, #07050D 0%, #0B0812 40%, #0B0812 100%);
    }
    a{color:inherit}
    .wrap{max-width:var(--max);margin:0 auto;padding:20px 16px 72px}
    .top{
      position:sticky;top:0;z-index:20;
      background: var(--glass);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--line2);
    }
    .topin{
      max-width:var(--max);
      margin:0 auto;
      padding:12px 16px;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
    }
    .brand{display:flex;gap:10px;align-items:center;min-width:240px}
    .dot{width:10px;height:10px;border-radius:999px;background:var(--accent);box-shadow:0 0 0 7px rgba(124,58,237,.14)}
    .brand b{font-size:13px;letter-spacing:.25px}
    .brand span{font-size:12px;color:var(--muted2)}
    .search{
      flex:1;
      min-width: 240px;
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px 12px;
      border-radius: 14px;
      background: rgba(18,13,30,.66);
      border:1px solid var(--line2);
    }
    .search input{
      width:100%;
      border:0;
      outline:0;
      background:transparent;
      color:var(--text);
      font-size:14px;
    }
    .btn{
      border:1px solid var(--line2);
      background: rgba(18,13,30,.62);
      color: var(--text);
      padding:10px 12px;
      border-radius: 14px;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease;
      white-space:nowrap;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(124,58,237,.40)}
    .btn.primary{
      border-color: rgba(124,58,237,.48);
      background: rgba(124,58,237,.18);
    }

    .hero{
      margin-top:18px;
      border-radius: var(--r);
      border:1px solid var(--line2);
      background: linear-gradient(180deg, rgba(18,13,30,.84), rgba(18,13,30,.58));
      box-shadow: var(--shadow);
      padding:18px;
      overflow:hidden;
      position:relative;
    }
    .hero:before{
      content:"";
      position:absolute;inset:-120px -160px auto auto;
      width:380px;height:380px;
      background: radial-gradient(circle at 30% 30%, rgba(124,58,237,.26), transparent 60%);
      filter: blur(2px);
      pointer-events:none;
    }
    .kickers{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .chip{
      font-size:12px;
      color: var(--muted);
      padding:7px 10px;
      border-radius: 999px;
      border:1px solid var(--line2);
      background: rgba(11,8,18,.28);
    }
    h1{margin:6px 0 10px;font-size:30px;line-height:1.18;letter-spacing:-.2px}
    .lead{margin:0;color: var(--muted);line-height: var(--lh);max-width: 980px;font-size: 14.7px}

    .grid{margin-top:14px;display:grid;gap:12px;grid-template-columns: 1fr;}
    @media(min-width:1020px){ .grid{grid-template-columns: 360px 1fr;} }

    .side,.content{
      border-radius: var(--r);
      border:1px solid var(--line2);
      background: rgba(18,13,30,.56);
      box-shadow: 0 12px 28px rgba(0,0,0,.26);
    }
    .side{padding:14px;position: sticky;top: 70px;height: fit-content;}
    .side h3{
      margin:2px 0 10px;
      font-size:12px;
      color: rgba(167,139,250,.92);
      letter-spacing:.6px;
      text-transform: uppercase;
    }
    .toc{display:flex;flex-direction:column;gap:8px;max-height: calc(100vh - 170px); overflow:auto; padding-right:6px}
    .toc a{
      padding:10px 10px;
      border-radius: 14px;
      border:1px solid var(--line2);
      background: rgba(11,8,18,.20);
      color: rgba(245,246,250,.92);
      font-size: 13px;
      line-height: 1.25;
      text-decoration:none;
    }
    .toc a:hover{border-color: rgba(124,58,237,.40)}
    .mini{
      margin-top:10px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid var(--line2);
      background: rgba(11,8,18,.18);
      color: var(--muted2);
      font-size:12px;
      line-height:1.55;
    }
    .mini b{color: rgba(245,246,250,.95)}
    .content{padding:14px}

    .section{
      border-radius: 16px;
      border:1px solid var(--line2);
      background: rgba(11,8,18,.16);
      padding:14px;
      margin-bottom:12px;
    }
    .section h2{margin:0 0 10px;font-size:18px;color: rgba(167,139,250,.98);letter-spacing:-.15px}
    .meta{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 10px}
    .pill{font-size:12px;color: var(--muted);padding:6px 10px;border-radius: 999px;border:1px solid var(--line2);background: rgba(18,13,30,.35)}

    .block{
      border-radius: var(--r2);
      border:1px solid var(--line2);
      background: rgba(18,13,30,.40);
      padding:12px;
      margin-top:10px;
    }
    .text{color: var(--muted);font-size:14px;line-height: var(--lh);}
    .text b{color: rgba(245,246,250,.96)}
    ul,ol{margin:8px 0 0 18px;padding:0}
    li{margin:6px 0}
    .hr{height:1px;background: var(--line2);margin:12px 0}
    .cols{display:grid;gap:10px;grid-template-columns:1fr}
    @media(min-width:900px){.cols{grid-template-columns:1fr 1fr}}
    .callout{border-radius: var(--r2);border:1px solid var(--line2);background: rgba(11,8,18,.22);padding:12px}
    .callout strong{color: rgba(245,246,250,.96)}
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size:12px;padding:2px 6px;border-radius:8px;border:1px solid var(--line2);
      background: rgba(11,8,18,.22);color: rgba(245,246,250,.95);
    }
    .code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size:12px;white-space:pre-wrap;word-break:break-word;color: rgba(245,246,250,.95);
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
    .hint{font-size:12px;color: var(--muted2);line-height:1.5;margin-top:6px}
    mark{background: rgba(124,58,237,.28);color: rgba(245,246,250,.98);padding: 0 2px;border-radius: 6px;}
  </style>
</head>

<body>
  <div class="top">
    <div class="topin">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <b>Денис • внутренняя реклама Wildberries</b><br>
          <span>практический бесплатный гайд</span>
        </div>
      </div>

      <div class="search" title="Поиск по гайду">
        <span style="color:rgba(199,185,255,.65);font-size:12px">Поиск</span>
        <input id="q" placeholder="CTR, CPC, корзина, выкуп, рекомендации, фото, ставка" />
        <button class="btn" id="clear">Очистить</button>
      </div>

      <button class="btn primary" id="copySummary">Скопировать краткую диагностику</button>
    </div>
  </div>

  <div class="wrap">
    <div class="hero">
      <div class="kickers">
        <span class="chip">Диагностика по воронке</span>
        <span class="chip">Только действия</span>
        <span class="chip">Тесты по правилам</span>
        <span class="chip">Экономика с выкупом</span>
        <span class="chip">Шаблоны</span>
        <span class="chip">Калькулятор в конце</span>
      </div>

      <h1>Клики есть, показы есть — а прибыли нет</h1>
      <p class="lead">
        На WB реклама усиливает то, что уже происходит в карточке и в ожиданиях покупателя.
        Чтобы выйти в плюс, не нужно угадывать настройки. Нужно найти, <b>на каком шаге</b> теряется результат:
        <b>показы → клики → карточка → корзина → заказ → выкуп</b>, и последовательно улучшать один приоритет за раз.
      </p>
    </div>

    <div class="grid">
      <aside class="side">
        <h3>Маршрут</h3>
        <div class="toc">
          <a href="#s0">0) Быстрая диагностика: куда смотреть</a>
          <a href="#s1">1) Воронка WB: что означает каждый шаг</a>
          <a href="#s2">2) Источник трафика: поиск vs рекомендации</a>
          <a href="#s3">3) CTR низкий: витрина (фото/цена/доверие)</a>
          <a href="#s4">4) Клики есть, корзины мало: первый экран и конкретика</a>
          <a href="#s5">5) Корзины есть, заказов мало: условия покупки</a>
          <a href="#s6">6) Заказы есть, но «дорого»: как вернуть экономику</a>
          <a href="#s7">7) Выкуп: как считать реальную стоимость заказа</a>
          <a href="#s8">8) A/B тест главного фото: протокол без ошибок</a>
          <a href="#s9">9) Нецелевой трафик: признаки и корректировка</a>
          <a href="#s10">10) Масштабирование: когда трогать ставки</a>
          <a href="#s11">11) 7-дневный план (3 сценария)</a>
          <a href="#s12">12) Шаблоны: журнал тестов и гипотез</a>
          <a href="#s13">13) Калькулятор цены заказа</a>
        </div>

        <div class="mini">
          <b>Правило:</b> одно изменение → фиксация метрик → вывод. <br>
          Если менять всё одновременно, ты не узнаешь, что реально сработало.
        </div>
      </aside>

      <main class="content" id="content">

        <section class="section" id="s0">
          <h2>0) Быстрая диагностика: куда смотреть</h2>
          <div class="meta">
            <span class="pill">2 минуты</span>
            <span class="pill">по симптомам</span>
          </div>

          <div class="block">
            <div class="text">
              <ul>
                <li><b>CTR низкий</b> → витрина: фото/цена/доверие. См. раздел <a href="#s3"><span class="kbd">3</span></a>.</li>
                <li><b>Клики есть, корзины мало</b> → карточка: смысл первого экрана, конкретика, ответы на сомнения. См. <a href="#s4"><span class="kbd">4</span></a>.</li>
                <li><b>Корзины есть, заказов мало</b> → условия покупки: доставка/наличие/итоговая цена. См. <a href="#s5"><span class="kbd">5</span></a>.</li>
                <li><b>Заказы есть, но прибыль не сходится</b> → считать по выкупу и марже. См. <a href="#s7"><span class="kbd">7</span></a> и калькулятор <a href="#s13"><span class="kbd">13</span></a>.</li>
              </ul>
            </div>
          </div>

          <div class="cols">
            <div class="callout">
              <div class="text">
                <strong>Мини-правило.</strong> Ставка усиливает результат. Сначала — конверсия и доверие, потом — объём.
              </div>
            </div>
            <div class="callout">
              <div class="text">
                <strong>Быстрый сигнал.</strong> Если клики есть, а корзина слабая — человек не увидел ценность или не поверил.
              </div>
            </div>
          </div>
        </section>

        <section class="section" id="s1">
          <h2>1) Воронка WB: что означает каждый шаг</h2>
          <div class="meta">
            <span class="pill">показы → клики → карточка → корзина → заказ → выкуп</span>
          </div>

          <div class="block">
            <div class="text">
              <ul>
                <li><b>Показы</b> — присутствие в выдаче/лентах.</li>
                <li><b>Клики (CTR)</b> — витрина убедила открыть.</li>
                <li><b>Карточка</b> — за секунды понятно: что это, кому, почему стоит своих денег.</li>
                <li><b>Корзина</b> — интерес стал намерением.</li>
                <li><b>Заказ</b> — решение принято, важны условия.</li>
                <li><b>Выкуп</b> — реальная экономика.</li>
              </ul>
            </div>
          </div>

          <div class="callout" style="margin-top:10px">
            <div class="text">
              <strong>Главная мысль:</strong> реклама быстрее показывает слабое место. Поэтому начинать нужно с диагностики, а не со ставок.
            </div>
          </div>
        </section>

        <section class="section" id="s2">
          <h2>2) Источник трафика: поиск vs рекомендации</h2>
          <div class="meta">
            <span class="pill">разное намерение</span>
            <span class="pill">разная подача</span>
          </div>

          <div class="cols">
            <div class="block">
              <div class="text">
                <b>Поиск</b> — человек сравнивает и выбирает.
                <div class="hr"></div>
                <ul>
                  <li>понятно «что это» за 1 секунду;</li>
                  <li>одно отличие от конкурентов;</li>
                  <li>доверие: рейтинг/отзывы/доказательства на фото.</li>
                </ul>
              </div>
            </div>

            <div class="block">
              <div class="text">
                <b>Рекомендации</b> — человек листает, нужно зацепить быстро.
                <div class="hr"></div>
                <ul>
                  <li>визуальный крючок без перегруза;</li>
                  <li>простая выгода в одном сообщении;</li>
                  <li>первый экран карточки сразу закрывает «почему это стоит своих денег».</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="callout" style="margin-top:10px">
            <div class="text">
              <strong>Если кликов много, а корзина слабая:</strong> часто витрина не подходит под источник трафика или трафик нецелевой (см. раздел 9).
            </div>
          </div>
        </section>

        <section class="section" id="s3">
          <h2>3) CTR низкий: витрина (фото/цена/доверие)</h2>
          <div class="meta">
            <span class="pill">цель: поднять интерес к клику</span>
            <span class="pill">фокус: главное фото</span>
          </div>

          <div class="block">
            <div class="text">
              <b>Причины:</b>
              <ul>
                <li>неясно, что за товар;</li>
                <li>ценность не видна → остаётся сравнение по цене;</li>
                <li>не хватает доверия.</li>
              </ul>

              <div class="hr"></div>

              <b>Проверка:</b>
              <ul>
                <li>за 1 секунду понятно «что это»?</li>
                <li>за 3 секунды понятно «в чём выгода»?</li>
                <li>видно ли доказательство качества/комплекта?</li>
              </ul>

              <div class="hr"></div>

              <b>Что делать:</b>
              <ul>
                <li>2–3 версии главного фото под разные гипотезы: <b>выгода</b> / <b>качество-деталь</b> / <b>комплект</b>;</li>
                <li>во время теста не менять цену/ставки/описание;</li>
                <li>оценивать по связке метрик (см. раздел 8).</li>
              </ul>
            </div>
          </div>
        </section>

        <section class="section" id="s4">
          <h2>4) Клики есть, корзины мало: первый экран и конкретика</h2>
          <div class="meta">
            <span class="pill">смысл за секунды</span>
            <span class="pill">доверие и факты</span>
          </div>

          <div class="block">
            <div class="text">
              <b>Проверка:</b>
              <ul>
                <li>первые 3–5 фото отвечают на основные вопросы покупателя?</li>
                <li>есть конкретика (материал/размер/комплект/детали), а не общие слова?</li>
                <li>закрыто главное сомнение (качество, соответствие ожиданиям)?</li>
              </ul>

              <div class="hr"></div>

              <b>Решение:</b>
              <ul>
                <li><b>1 экран:</b> что это + для кого + одна выгода + 1–2 доказательства;</li>
                <li><b>2–4 фото:</b> конкретика (материал/детали/размер/комплект);</li>
                <li><b>5–7 фото:</b> ответы на сомнения (качество, упаковка, уход, посадка).</li>
              </ul>
            </div>
          </div>
        </section>

        <section class="section" id="s5">
          <h2>5) Корзины есть, заказов мало: условия покупки</h2>
          <div class="meta">
            <span class="pill">доставка</span>
            <span class="pill">наличие</span>
            <span class="pill">итоговая цена</span>
          </div>

          <div class="block">
            <div class="text">
              <b>Проверка:</b>
              <ul>
                <li>есть ключевые размеры/цвета в наличии?</li>
                <li>сроки доставки не хуже, чем у топ-конкурентов?</li>
                <li>цена соответствует ожиданию, которое сформировала витрина?</li>
              </ul>

              <div class="hr"></div>

              <b>Что делать:</b>
              <ul>
                <li>стабилизировать наличие ключевых вариантов;</li>
                <li>если цена выше — усилить доказательства ценности в первых экранах;</li>
                <li>если сроки заметно хуже — не увеличивать объём рекламы, пока это не исправлено.</li>
              </ul>
            </div>
          </div>
        </section>

        <section class="section" id="s6">
          <h2>6) Заказы есть, но «дорого»: как вернуть экономику</h2>
          <div class="meta">
            <span class="pill">связка метрик</span>
            <span class="pill">прибыль важнее CTR/CPC</span>
          </div>

          <div class="block">
            <div class="text">
              Смотри цепочку:
              <div class="hr"></div>
              <div class="code">CTR → CPC → корзина/клик → заказ/клик → выкуп</div>
              <div class="hr"></div>
              <b>Приоритет:</b> сначала улучшить слабый шаг (разделы 3–5), затем проверить экономику с выкупом (раздел 7 и калькулятор).
            </div>
          </div>
        </section>

        <section class="section" id="s7">
          <h2>7) Выкуп: как считать реальную стоимость заказа</h2>
          <div class="meta">
            <span class="pill">стоимость заказа ≠ стоимость выкупа</span>
          </div>

          <div class="block">
            <div class="text">
              <b>Формулы:</b>
              <div class="hr"></div>
              <div class="code">Стоимость заказа = расход / заказы
Стоимость выкупленного заказа = расход / (заказы × выкуп)</div>
              <div class="hr"></div>
              Если стоимость выкупленного заказа выше маржи — реклама экономически не сходится.
            </div>
          </div>
        </section>

        <section class="section" id="s8">
          <h2>8) A/B тест главного фото: протокол без ошибок</h2>
          <div class="meta">
            <span class="pill">1 тест = 1 параметр</span>
            <span class="pill">равные условия</span>
          </div>

          <div class="block">
            <div class="text">
              <ul>
                <li>меняем только главное фото;</li>
                <li>не меняем цену/ставки/описание/остатки во время теста;</li>
                <li>сравниваем в одинаковые часы и по сопоставимому объёму.</li>
              </ul>
              <div class="hr"></div>
              Победитель — тот, кто улучшает экономику: <b>CTR → CPC → корзина/клик → заказ/клик</b>.
            </div>
          </div>
        </section>

        <section class="section" id="s9">
          <h2>9) Нецелевой трафик: признаки и корректировка</h2>
          <div class="meta">
            <span class="pill">клики ≠ покупки</span>
            <span class="pill">сужение</span>
          </div>

          <div class="block">
            <div class="text">
              <b>Признаки:</b>
              <ul>
                <li>кликов много, корзина/клик низкая;</li>
                <li>корзины есть, но заказов мало без проблем в условиях покупки;</li>
                <li>в рекомендациях кликают «посмотреть», но не покупают.</li>
              </ul>
              <div class="hr"></div>
              <b>Что делать:</b>
              <ul>
                <li>сузить запросы/сегменты до покупательских;</li>
                <li>адаптировать витрину под источник (раздел 2);</li>
                <li>оставить один понятный сценарий покупки.</li>
              </ul>
            </div>
          </div>
        </section>

        <section class="section" id="s10">
          <h2>10) Масштабирование: когда трогать ставки</h2>
          <div class="meta">
            <span class="pill">сначала стабильность</span>
            <span class="pill">потом объём</span>
          </div>

          <div class="block">
            <div class="text">
              Повышать ставки имеет смысл, когда:
              <ul>
                <li>витрина даёт стабильный CTR;</li>
                <li>карточка держит корзину/клик;</li>
                <li>экономика сходится по выкупу (раздел 7) и по калькулятору (раздел 13).</li>
              </ul>
            </div>
          </div>
        </section>

        <section class="section" id="s11">
          <h2>11) 7-дневный план (3 сценария)</h2>
          <div class="meta">
            <span class="pill">короткие циклы</span>
            <span class="pill">1 гипотеза за раз</span>
          </div>

          <div class="cols">
            <div class="block">
              <div class="text">
                <b>Сценарий A: CTR низкий</b>
                <ul>
                  <li>Д1–Д3: 2–3 версии главного фото → тест по протоколу.</li>
                  <li>Д4: закрепить победителя.</li>
                  <li>Д5–Д7: усилить первый экран и доверие.</li>
                </ul>
              </div>
            </div>

            <div class="block">
              <div class="text">
                <b>Сценарий B: корзина/клик низкая</b>
                <ul>
                  <li>Д1–Д2: перестроить первые 3–5 фото по структуре (раздел 4).</li>
                  <li>Д3–Д7: тестировать по одной гипотезе.</li>
                </ul>
              </div>
            </div>

            <div class="block">
              <div class="text">
                <b>Сценарий C: экономика ломается выкупом</b>
                <ul>
                  <li>Д1: найти разрыв ожиданий.</li>
                  <li>Д2–Д4: добавить доказательства качества/деталей/комплекта.</li>
                  <li>Д5–Д7: стабилизировать и только потом увеличивать объём.</li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <section class="section" id="s12">
          <h2>12) Шаблоны: журнал тестов и гипотез</h2>
          <div class="meta">
            <span class="pill">копируй</span>
            <span class="pill">фиксируй</span>
          </div>

          <div class="block">
            <div class="code" id="journalTpl">Дата/период:
Что изменил (1 параметр):
Цель (какую метрику улучшаю):
Условия (источник/ставка/время/объём):
До → после (CTR/CPC/корзина/заказы/выкуп):
Вывод (оставляю / откатываю / повторяю):</div>
            <div class="row">
              <button class="btn" id="copyJournal">Скопировать журнал</button>
              <span class="hint">Один тест = одно изменение.</span>
            </div>
          </div>

          <div class="block">
            <div class="code" id="hypTpl">Я меняю [X], чтобы улучшить [Y], потому что [Z]. Оцениваю через 72 часа по метрикам: [CTR/CPC/корзина/заказ/выкуп].</div>
            <div class="row">
              <button class="btn" id="copyHyp">Скопировать гипотезу</button>
              <span class="hint">Так ты точно понимаешь, что дало результат.</span>
            </div>
          </div>
        </section>

        <!-- Новый раздел с внешним калькулятором -->
        <section class="section" id="s13">
          <h2>13) Калькулятор цены заказа (встроен в гайд)</h2>
          <div class="meta">
            <span class="pill">онлайн</span>
            <span class="pill">с телефона и ПК</span>
          </div>

          <div class="block">
            <div class="text">
              Используй калькулятор, чтобы быстро посчитать экономику заказа и понять, какие параметры влияют на итоговую прибыль.
            </div>

            <div class="hr"></div>

            <div style="border-radius:14px; overflow:hidden; border:1px solid var(--line2); background: rgba(11,8,18,.18);">
              <iframe
                src="https://chikalov966-del.github.io/cenazakaza/"
                style="width:100%; height: 980px; border:0; display:block;"
                loading="lazy"
                referrerpolicy="no-referrer"
                title="Калькулятор цены заказа"
              ></iframe>
            </div>

            <div class="hint">
              Если у кого-то не открывается внутри страницы, можно открыть в новой вкладке:
              <a href="https://chikalov966-del.github.io/cenazakaza/" target="_blank" rel="noopener" style="text-decoration:underline">перейти к калькулятору</a>.
            </div>
          </div>
        </section>

      </main>
    </div>
  </div>

  <script>
    // Search
    const q = document.getElementById('q');
    const clearBtn = document.getElementById('clear');
    const content = document.getElementById('content');

    function norm(s){ return (s||'').toLowerCase().trim(); }

    function removeMarks(root){
      root.querySelectorAll('mark').forEach(m=>{
        const t = document.createTextNode(m.textContent);
        m.replaceWith(t);
      });
    }

    function highlight(root, query){
      removeMarks(root);
      if(!query) return;

      const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null);
      const nodes = [];
      while(walker.nextNode()) nodes.push(walker.currentNode);

      nodes.forEach(node=>{
        const val = node.nodeValue;
        const low = val.toLowerCase();
        const idx = low.indexOf(query);
        if(idx === -1) return;

        const before = val.slice(0, idx);
        const match  = val.slice(idx, idx + query.length);
        const after  = val.slice(idx + query.length);

        const mark = document.createElement('mark');
        mark.textContent = match;

        const frag = document.createDocumentFragment();
        frag.appendChild(document.createTextNode(before));
        frag.appendChild(mark);
        frag.appendChild(document.createTextNode(after));
        node.parentNode.replaceChild(frag, node);
      });
    }

    function filter(query){
      const nq = norm(query);
      const sections = content.querySelectorAll('.section');
      sections.forEach(s=>{
        const txt = norm(s.innerText);
        const show = !nq || txt.includes(nq);
        s.style.display = show ? '' : 'none';
      });
      highlight(content, nq);
    }

    q.addEventListener('input', (e)=>filter(e.target.value));
    clearBtn.addEventListener('click', ()=>{ q.value=''; filter(''); });

    // Clipboard
    async function copyText(btn, text, okLabel='Скопировано', backLabel){
      try{
        await navigator.clipboard.writeText(text);
        const old = btn.textContent;
        btn.textContent = okLabel;
        setTimeout(()=>btn.textContent = backLabel || old, 1200);
      }catch(e){
        alert('Не удалось скопировать. Скопируй вручную.');
      }
    }

    document.getElementById('copySummary').addEventListener('click', ()=>{
      const summary =
`WB — быстрая диагностика:
1) CTR низкий → фото/цена/доверие (витрина).
2) Клики есть, корзины мало → первый экран, конкретика, ответы на сомнения.
3) Корзины есть, заказов мало → доставка, наличие, итоговая цена.
4) Заказы есть, но прибыль не сходится → считать по выкупу и марже.
Правило: 1 тест = 1 изменение.`;
      copyText(document.getElementById('copySummary'), summary, 'Скопировано', 'Скопировать краткую диагностику');
    });

    document.getElementById('copyJournal').addEventListener('click', ()=>{
      copyText(document.getElementById('copyJournal'), document.getElementById('journalTpl').innerText);
    });
    document.getElementById('copyHyp').addEventListener('click', ()=>{
      copyText(document.getElementById('copyHyp'), document.getElementById('hypTpl').innerText);
    });

    filter('');
  </script>
</body>
</html>
